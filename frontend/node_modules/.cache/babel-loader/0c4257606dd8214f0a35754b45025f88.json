{"ast":null,"code":"import _classCallCheck from\"/home/dilip/Desktop/MERN/himalayadonelocal2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/dilip/Desktop/MERN/himalayadonelocal2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/dilip/Desktop/MERN/himalayadonelocal2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/dilip/Desktop/MERN/himalayadonelocal2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{MDBDataTableV5}from'mdbreact';import Menu from'./menu.component';import'../css/sale.css';import axios from'axios';var Customer=/*#__PURE__*/function(_Component){_inherits(Customer,_Component);var _super=_createSuper(Customer);function Customer(props){var _this;_classCallCheck(this,Customer);_this=_super.call(this,props);_this.errorOccured=function(status,err,message){var error={\"id\":_this.state.errors.length+1,\"status\":status,\"error\":err,\"message\":message};var errors=_this.state.errors;errors.push(error);_this.setState(errors);};_this.deleteError=function(e){var key=e.currentTarget.parentNode.getAttribute(\"data-key\");var errors=_this.state.errors.filter(function(error){return parseInt(error.id)!==parseInt(key);});_this.setState({errors:errors});};_this.update_rows=function(response){try{var columns=_this.state.datatable.columns;var rows=_this.state.datatable.rows;if(response.status===200){response.Data.results.forEach(function(element){if(element.customer!=null){var row={'fname':element.customer.fname,'lname':element.customer.lname,'mobile':element.customer.mobile,'amount_payable':element.amount_payable,'total_discount':element.total_discount,'payment_method':element.payment_method!=null?element.payment_method.name:\"deleted\",'date':element.customer.date,'receipt_pdf':element.receipt_pdf?/*#__PURE__*/React.createElement(\"a\",{href:element.receipt_pdf,target:\"blank\"},\"click\"):\"\"};rows.push(row);}});var datatable={columns:columns,rows:rows};_this.setState({datatable:datatable});}}catch(error){// this.errorOccured(500, \"erro occurred\", error.toString())\n}};_this.get_next=function(response){try{var headers={'Authorization':'Token '+sessionStorage.getItem('token')};axios.get(response,{headers:headers}).then(function(result){_this.update_rows(result.data);if(result.data.Data.links.next!=null){_this.get_next(result.data.Data.links.next);}});}catch(error){// this.errorOccured(500, \"erro occurred\", error.toString())\n}};_this.componentDidMount=function(){var headers={'Authorization':'Token '+sessionStorage.getItem('token')};axios.get(window.API_URL+'/receipts/',{headers:headers}).then(function(response){console.log(response);if(response.status==200){if(response.data.status==404){_this.errorOccured(404,response.data.error.error,\"Error\");}else if(response.data.status==200){_this.update_rows(response.data);_this.get_next(response.data.Data.links.next);}else{_this.errorOccured(response.data.status,response.error.error,\"Unknown Error Occurred\");}}else{_this.errorOccured(500,\"erro occurred\",\"Unknown error occurred\");}}).catch(function(error){// this.errorOccured(500, \"error occurred\", error.message)\n});};if(sessionStorage.getItem('token')==='undefined'||sessionStorage.getItem('username')==='undefined'){_this.props.history.push('/');}_this.state={datatable:{columns:[{label:'FirstName',field:'fname',width:150},{label:'LastName',field:'lname',width:270},{label:'Mobile',field:'mobile',width:270},{label:'Amount Paid',field:'amount_payable',width:200},{label:'Discount Provided',field:'total_discount',sort:'disabled',width:150},{label:'Payment Type',field:'payment_method',width:270},{label:'Date',field:'date',width:270},{label:'Reciept',field:'receipt_pdf',width:270}],rows:[]},errors:[]};_this.payments=\"\";var _headers={'Authorization':'Token '+sessionStorage.getItem('token')};axios.get(window.API_URL+'/payments/payments_today/',{headers:_headers}).then(function(response){if(response.status==200){if(response.data.status==404){_this.errorOccured(404,response.data.error.error,\"Error\");}if(response.data.status==200){var payments=response.data.Data.amount_wise_payment_list.map(function(payment){return/*#__PURE__*/React.createElement(\"tr\",null,\" \",/*#__PURE__*/React.createElement(\"th\",{style:{color:\"green\"}},payment.name?payment.name:\"deleted payment option\"),/*#__PURE__*/React.createElement(\"td\",null,payment.amount));});var total_amount=response.data.Data.total_amount_paid_today;_this.setState({payments:payments,total_amount:total_amount});}else{_this.errorOccured(response.data.status,response.error.error,\"Unknown Error Occurred\");}}else{_this.errorOccured(500,\"error occurred\",\"Unknown error occurred\");}}).catch(function(error){// this.errorOccured(500, \"error occurred\", error.message)\n});return _this;}_createClass(Customer,[{key:\"render\",value:function render(){var _this2=this;var Error=this.state.errors.length?this.state.errors.map(function(error){return/*#__PURE__*/React.createElement(\"div\",{\"data-key\":error.id,className:\"alert alert-danger alert-dismissible override\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\",onClick:_this2.deleteError,class:\"close\",\"data-dismiss\":\"alert\",\"aria-label\":\"close\"},\"\\xD7\"),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"error!\"),\" \",error.error),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"message\"),\" \",error.message),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"status\"),\" \",error.status));}):\"\";return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Menu,null),Error,/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:\"black\",fontSize:\"15px\",color:\"green\"}},/*#__PURE__*/React.createElement(MDBDataTableV5,{className:\"table-responsive\",style:{backgroundColor:\"black\",fontSize:\"20px\",color:\"white\"},hover:true,entriesOptions:[10,20,25],entries:10,pagesAmount:4,data:this.state.datatable,searchTop:true,searchBottom:false})),/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:\"left\",backgroundColor:\"black\",fontSize:\"20px\",color:\"white\"}},/*#__PURE__*/React.createElement(\"table\",{style:{width:\"100%\"}},/*#__PURE__*/React.createElement(\"tr\",{style:{color:\"red\"}},/*#__PURE__*/React.createElement(\"th\",null,\"Payment Type\"),/*#__PURE__*/React.createElement(\"th\",null,\"Amount Paid\")),this.state.payments,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",{style:{color:\"blue\"}},\"Total\"),/*#__PURE__*/React.createElement(\"td\",{style:{color:\"blue\"}},this.state.total_amount)))));}}]);return Customer;}(Component);export default Customer;","map":{"version":3,"sources":["/home/dilip/Desktop/MERN/himalayadonelocal2/src/components/sale.component.js"],"names":["React","Component","MDBDataTableV5","Menu","axios","Customer","props","errorOccured","status","err","message","error","state","errors","length","push","setState","deleteError","e","key","currentTarget","parentNode","getAttribute","filter","parseInt","id","update_rows","response","columns","datatable","rows","Data","results","forEach","element","customer","row","fname","lname","mobile","amount_payable","total_discount","payment_method","name","date","receipt_pdf","get_next","headers","sessionStorage","getItem","get","then","result","data","links","next","componentDidMount","window","API_URL","console","log","catch","history","label","field","width","sort","payments","amount_wise_payment_list","map","payment","color","amount","total_amount","total_amount_paid_today","Error","backgroundColor","fontSize","textAlign"],"mappings":"wnBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,cAAT,KAA+B,UAA/B,CACA,MAAOC,CAAAA,IAAP,KAAiB,kBAAjB,CACA,MAAO,iBAAP,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,C,GAGMC,CAAAA,Q,oGACJ,kBAAYC,KAAZ,CAAmB,0CACjB,uBAAMA,KAAN,EADiB,MA8FnBC,YA9FmB,CA8FJ,SAACC,MAAD,CAASC,GAAT,CAAcC,OAAd,CAA0B,CACvC,GAAIC,CAAAA,KAAK,CAAG,CAAE,KAAM,MAAKC,KAAL,CAAWC,MAAX,CAAkBC,MAAlB,CAA2B,CAAnC,CAAsC,SAAUN,MAAhD,CAAwD,QAASC,GAAjE,CAAsE,UAAWC,OAAjF,CAAZ,CACA,GAAIG,CAAAA,MAAM,CAAG,MAAKD,KAAL,CAAWC,MAAxB,CACAA,MAAM,CAACE,IAAP,CAAYJ,KAAZ,EAEA,MAAKK,QAAL,CAAcH,MAAd,EACD,CApGkB,OAsGnBI,WAtGmB,CAsGL,SAACC,CAAD,CAAO,CACnB,GAAIC,CAAAA,GAAG,CAAGD,CAAC,CAACE,aAAF,CAAgBC,UAAhB,CAA2BC,YAA3B,CAAwC,UAAxC,CAAV,CAEA,GAAIT,CAAAA,MAAM,CAAG,MAAKD,KAAL,CAAWC,MAAX,CAAkBU,MAAlB,CAAyB,SAAAZ,KAAK,CAAI,CAC7C,MAAOa,CAAAA,QAAQ,CAACb,KAAK,CAACc,EAAP,CAAR,GAAuBD,QAAQ,CAACL,GAAD,CAAtC,CACD,CAFY,CAAb,CAGA,MAAKH,QAAL,CAAc,CAAEH,MAAM,CAAEA,MAAV,CAAd,EACD,CA7GkB,OAiHnBa,WAjHmB,CAiHL,SAACC,QAAD,CAAc,CAE1B,GAAI,CACF,GAAIC,CAAAA,OAAO,CAAG,MAAKhB,KAAL,CAAWiB,SAAX,CAAqBD,OAAnC,CACA,GAAIE,CAAAA,IAAI,CAAG,MAAKlB,KAAL,CAAWiB,SAAX,CAAqBC,IAAhC,CACA,GAAIH,QAAQ,CAACnB,MAAT,GAAoB,GAAxB,CAA6B,CAE3BmB,QAAQ,CAACI,IAAT,CAAcC,OAAd,CAAsBC,OAAtB,CAA8B,SAAAC,OAAO,CAAI,CAEvC,GAAIA,OAAO,CAACC,QAAR,EAAoB,IAAxB,CAA8B,CAC5B,GAAIC,CAAAA,GAAG,CAAG,CAAE,QAASF,OAAO,CAACC,QAAR,CAAiBE,KAA5B,CAAmC,QAASH,OAAO,CAACC,QAAR,CAAiBG,KAA7D,CAAoE,SAAUJ,OAAO,CAACC,QAAR,CAAiBI,MAA/F,CAAuG,iBAAkBL,OAAO,CAACM,cAAjI,CAAiJ,iBAAkBN,OAAO,CAACO,cAA3K,CAA2L,iBAAkBP,OAAO,CAACQ,cAAR,EAA0B,IAA1B,CAA+BR,OAAO,CAACQ,cAAR,CAAuBC,IAAtD,CAA4D,SAAzQ,CAAqR,OAAQT,OAAO,CAACC,QAAR,CAAiBS,IAA9S,CAAoT,cAAeV,OAAO,CAACW,WAAR,cAAuB,yBAAG,IAAI,CAAEX,OAAO,CAACW,WAAjB,CAA8B,MAAM,CAAC,OAArC,UAAvB,CAAkF,EAArZ,CAAV,CAEAf,IAAI,CAACf,IAAL,CAAUqB,GAAV,EACD,CACF,CAPD,EAUA,GAAIP,CAAAA,SAAS,CAAG,CAAED,OAAO,CAAEA,OAAX,CAAoBE,IAAI,CAAEA,IAA1B,CAAhB,CACA,MAAKd,QAAL,CAAc,CAAEa,SAAS,CAAEA,SAAb,CAAd,EACD,CACF,CACD,MAAOlB,KAAP,CAAc,CACZ;AAED,CACF,CA1IkB,OA4InBmC,QA5ImB,CA4IR,SAACnB,QAAD,CAAc,CACvB,GAAI,CACF,GAAMoB,CAAAA,OAAO,CAAG,CACd,gBAAiB,SAAWC,cAAc,CAACC,OAAf,CAAuB,OAAvB,CADd,CAAhB,CAIA7C,KAAK,CAAC8C,GAAN,CAAUvB,QAAV,CAAoB,CAAEoB,OAAO,CAAEA,OAAX,CAApB,EACGI,IADH,CACQ,SAAAC,MAAM,CAAI,CACd,MAAK1B,WAAL,CAAiB0B,MAAM,CAACC,IAAxB,EACA,GAAID,MAAM,CAACC,IAAP,CAAYtB,IAAZ,CAAiBuB,KAAjB,CAAuBC,IAAvB,EAA+B,IAAnC,CAAyC,CACvC,MAAKT,QAAL,CAAcM,MAAM,CAACC,IAAP,CAAYtB,IAAZ,CAAiBuB,KAAjB,CAAuBC,IAArC,EACD,CACF,CANH,EAOD,CACD,MAAO5C,KAAP,CAAc,CACZ;AAED,CAEF,CA/JkB,OAiKnB6C,iBAjKmB,CAiKC,UAAM,CACxB,GAAMT,CAAAA,OAAO,CAAG,CACd,gBAAiB,SAAWC,cAAc,CAACC,OAAf,CAAuB,OAAvB,CADd,CAAhB,CAGA7C,KAAK,CAAC8C,GAAN,CAAUO,MAAM,CAACC,OAAP,CAAe,YAAzB,CAAuC,CACrCX,OAAO,CAAEA,OAD4B,CAAvC,EAGGI,IAHH,CAGQ,SAAAxB,QAAQ,CAAI,CAChBgC,OAAO,CAACC,GAAR,CAAYjC,QAAZ,EACA,GAAIA,QAAQ,CAACnB,MAAT,EAAmB,GAAvB,CAA4B,CAE1B,GAAImB,QAAQ,CAAC0B,IAAT,CAAc7C,MAAd,EAAwB,GAA5B,CAAiC,CAC/B,MAAKD,YAAL,CAAkB,GAAlB,CAAuBoB,QAAQ,CAAC0B,IAAT,CAAc1C,KAAd,CAAoBA,KAA3C,CAAkD,OAAlD,EACD,CAFD,IAIK,IAAIgB,QAAQ,CAAC0B,IAAT,CAAc7C,MAAd,EAAwB,GAA5B,CAAiC,CACpC,MAAKkB,WAAL,CAAiBC,QAAQ,CAAC0B,IAA1B,EACA,MAAKP,QAAL,CAAcnB,QAAQ,CAAC0B,IAAT,CAActB,IAAd,CAAmBuB,KAAnB,CAAyBC,IAAvC,EAED,CAJI,IAKA,CAEH,MAAKhD,YAAL,CAAkBoB,QAAQ,CAAC0B,IAAT,CAAc7C,MAAhC,CAAwCmB,QAAQ,CAAChB,KAAT,CAAeA,KAAvD,CAA8D,wBAA9D,EACD,CACF,CAfD,IAgBK,CAEH,MAAKJ,YAAL,CAAkB,GAAlB,CAAuB,eAAvB,CAAwC,wBAAxC,EAED,CACF,CA1BH,EA2BGsD,KA3BH,CA2BS,SAAAlD,KAAK,CAAI,CAEd;AACD,CA9BH,EAiCD,CAtMkB,CAEjB,GAAIqC,cAAc,CAACC,OAAf,CAAuB,OAAvB,IAAoC,WAApC,EAAmDD,cAAc,CAACC,OAAf,CAAuB,UAAvB,IAAuC,WAA9F,CAA2G,CACzG,MAAK3C,KAAL,CAAWwD,OAAX,CAAmB/C,IAAnB,CAAwB,GAAxB,EACD,CACD,MAAKH,KAAL,CAAa,CACXiB,SAAS,CAAE,CACTD,OAAO,CAAE,CACP,CACEmC,KAAK,CAAE,WADT,CAEEC,KAAK,CAAE,OAFT,CAGEC,KAAK,CAAE,GAHT,CADO,CAMP,CACEF,KAAK,CAAE,UADT,CAEEC,KAAK,CAAE,OAFT,CAGEC,KAAK,CAAE,GAHT,CANO,CAWP,CACEF,KAAK,CAAE,QADT,CAEEC,KAAK,CAAE,QAFT,CAGEC,KAAK,CAAE,GAHT,CAXO,CAgBP,CACEF,KAAK,CAAE,aADT,CAEEC,KAAK,CAAE,gBAFT,CAGEC,KAAK,CAAE,GAHT,CAhBO,CAqBP,CACEF,KAAK,CAAE,mBADT,CAEEC,KAAK,CAAE,gBAFT,CAGEE,IAAI,CAAE,UAHR,CAIED,KAAK,CAAE,GAJT,CArBO,CA2BP,CACEF,KAAK,CAAE,cADT,CAEEC,KAAK,CAAE,gBAFT,CAGEC,KAAK,CAAE,GAHT,CA3BO,CAgCP,CACEF,KAAK,CAAE,MADT,CAEEC,KAAK,CAAE,MAFT,CAGEC,KAAK,CAAE,GAHT,CAhCO,CAqCP,CACEF,KAAK,CAAE,SADT,CAEEC,KAAK,CAAE,aAFT,CAGEC,KAAK,CAAE,GAHT,CArCO,CADA,CA4CTnC,IAAI,CAAE,EA5CG,CADA,CAgDXjB,MAAM,CAAE,EAhDG,CAAb,CAkDA,MAAKsD,QAAL,CAAgB,EAAhB,CACA,GAAIpB,CAAAA,QAAO,CAAG,CACZ,gBAAiB,SAAWC,cAAc,CAACC,OAAf,CAAuB,OAAvB,CADhB,CAAd,CAGA7C,KAAK,CAAC8C,GAAN,CAAUO,MAAM,CAACC,OAAP,CAAe,2BAAzB,CAAsD,CACpDX,OAAO,CAAEA,QAD2C,CAAtD,EAGGI,IAHH,CAGQ,SAAAxB,QAAQ,CAAI,CAEhB,GAAIA,QAAQ,CAACnB,MAAT,EAAmB,GAAvB,CAA4B,CAE1B,GAAImB,QAAQ,CAAC0B,IAAT,CAAc7C,MAAd,EAAwB,GAA5B,CAAiC,CAC/B,MAAKD,YAAL,CAAkB,GAAlB,CAAuBoB,QAAQ,CAAC0B,IAAT,CAAc1C,KAAd,CAAoBA,KAA3C,CAAkD,OAAlD,EACD,CAED,GAAIgB,QAAQ,CAAC0B,IAAT,CAAc7C,MAAd,EAAwB,GAA5B,CAAiC,CAC/B,GAAI2D,CAAAA,QAAQ,CAAGxC,QAAQ,CAAC0B,IAAT,CAActB,IAAd,CAAmBqC,wBAAnB,CAA4CC,GAA5C,CAAgD,SAAAC,OAAO,CAAI,CACxE,mBAAQ,+CAAK,0BAAI,KAAK,CAAE,CAAEC,KAAK,CAAE,OAAT,CAAX,EAAgCD,OAAO,CAAC3B,IAAR,CAAc2B,OAAO,CAAC3B,IAAtB,CAA6B,wBAA7D,CAAL,cAAiG,8BAAK2B,OAAO,CAACE,MAAb,CAAjG,CAAR,CACD,CAFc,CAAf,CAGA,GAAIC,CAAAA,YAAY,CAAG9C,QAAQ,CAAC0B,IAAT,CAActB,IAAd,CAAmB2C,uBAAtC,CACA,MAAK1D,QAAL,CAAc,CAAEmD,QAAQ,CAAEA,QAAZ,CAAsBM,YAAY,CAAEA,YAApC,CAAd,EAED,CAPD,IAQK,CAEH,MAAKlE,YAAL,CAAkBoB,QAAQ,CAAC0B,IAAT,CAAc7C,MAAhC,CAAwCmB,QAAQ,CAAChB,KAAT,CAAeA,KAAvD,CAA8D,wBAA9D,EACD,CACF,CAlBD,IAmBK,CAEH,MAAKJ,YAAL,CAAkB,GAAlB,CAAuB,gBAAvB,CAAyC,wBAAzC,EAED,CACF,CA7BH,EA8BGsD,KA9BH,CA8BS,SAAAlD,KAAK,CAAI,CACd;AACD,CAhCH,EA3DiB,aA4FlB,C,4DA4GQ,iBACP,GAAIgE,CAAAA,KAAK,CAAG,KAAK/D,KAAL,CAAWC,MAAX,CAAkBC,MAAlB,CAA2B,KAAKF,KAAL,CAAWC,MAAX,CAAkBwD,GAAlB,CAAsB,SAAA1D,KAAK,CAAI,CACpE,mBAAQ,2BAAK,WAAUA,KAAK,CAACc,EAArB,CAAyB,SAAS,CAAC,+CAAnC,eACN,yBAAG,IAAI,CAAC,GAAR,CAAY,OAAO,CAAE,MAAI,CAACR,WAA1B,CAAuC,KAAK,CAAC,OAA7C,CAAqD,eAAa,OAAlE,CAA0E,aAAW,OAArF,SADM,cAEN,4CAAK,2CAAL,KAA8BN,KAAK,CAACA,KAApC,CAFM,cAGN,4CAAK,4CAAL,KAA+BA,KAAK,CAACD,OAArC,CAHM,cAIN,4CAAK,2CAAL,KAA8BC,KAAK,CAACH,MAApC,CAJM,CAAR,CAKD,CANsC,CAA3B,CAMN,EANN,CAOA,mBACE,4CACE,oBAAC,IAAD,MADF,CAEGmE,KAFH,cAGE,2BAAK,KAAK,CAAE,CAAEC,eAAe,CAAE,OAAnB,CAA4BC,QAAQ,CAAE,MAAtC,CAA8CN,KAAK,CAAE,OAArD,CAAZ,eACE,oBAAC,cAAD,EAAgB,SAAS,CAAC,kBAA1B,CAA6C,KAAK,CAAE,CAAEK,eAAe,CAAE,OAAnB,CAA4BC,QAAQ,CAAE,MAAtC,CAA8CN,KAAK,CAAE,OAArD,CAApD,CAAoH,KAAK,KAAzH,CAA0H,cAAc,CAAE,CAAC,EAAD,CAAK,EAAL,CAAS,EAAT,CAA1I,CAAwJ,OAAO,CAAE,EAAjK,CAAqK,WAAW,CAAE,CAAlL,CAAqL,IAAI,CAAE,KAAK3D,KAAL,CAAWiB,SAAtM,CAAiN,SAAS,KAA1N,CAA2N,YAAY,CAAE,KAAzO,EADF,CAHF,cAME,2BAAK,KAAK,CAAE,CAAEiD,SAAS,CAAE,MAAb,CAAqBF,eAAe,CAAE,OAAtC,CAA+CC,QAAQ,CAAE,MAAzD,CAAiEN,KAAK,CAAE,OAAxE,CAAZ,eACE,6BAAO,KAAK,CAAE,CAAEN,KAAK,CAAE,MAAT,CAAd,eACE,0BAAI,KAAK,CAAE,CAAEM,KAAK,CAAE,KAAT,CAAX,eACE,6CADF,cAEE,4CAFF,CADF,CAOG,KAAK3D,KAAL,CAAWuD,QAPd,cAQE,2CACE,0BAAI,KAAK,CAAE,CAAEI,KAAK,CAAE,MAAT,CAAX,UADF,cAEE,0BAAI,KAAK,CAAE,CAAEA,KAAK,CAAE,MAAT,CAAX,EAA+B,KAAK3D,KAAL,CAAW6D,YAA1C,CAFF,CARF,CADF,CANF,CADF,CA2BD,C,sBA5OoBxE,S,EA8OvB,cAAeI,CAAAA,QAAf","sourcesContent":["import React, { Component } from 'react'\nimport { MDBDataTableV5 } from 'mdbreact';\nimport Menu from './menu.component'\nimport '../css/sale.css';\nimport axios from 'axios';\n\n\nclass Customer extends Component {\n  constructor(props) {\n    super(props);\n    if (sessionStorage.getItem('token') === 'undefined' || sessionStorage.getItem('username') === 'undefined') {\n      this.props.history.push('/')\n    }\n    this.state = {\n      datatable: {\n        columns: [\n          {\n            label: 'FirstName',\n            field: 'fname',\n            width: 150,\n          },\n          {\n            label: 'LastName',\n            field: 'lname',\n            width: 270,\n          },\n          {\n            label: 'Mobile',\n            field: 'mobile',\n            width: 270,\n          },\n          {\n            label: 'Amount Paid',\n            field: 'amount_payable',\n            width: 200,\n          },\n          {\n            label: 'Discount Provided',\n            field: 'total_discount',\n            sort: 'disabled',\n            width: 150,\n          },\n          {\n            label: 'Payment Type',\n            field: 'payment_method',\n            width: 270,\n          },\n          {\n            label: 'Date',\n            field: 'date',\n            width: 270,\n          },\n          {\n            label: 'Reciept',\n            field: 'receipt_pdf',\n            width: 270,\n          }\n        ],\n        rows: [\n        ],\n      },\n      errors: []\n    }\n    this.payments = \"\";\n    var headers = {\n      'Authorization': 'Token ' + sessionStorage.getItem('token')\n    }\n    axios.get(window.API_URL+'/payments/payments_today/', {\n      headers: headers\n    })\n      .then(response => {\n\n        if (response.status == 200) {\n\n          if (response.data.status == 404) {\n            this.errorOccured(404, response.data.error.error, \"Error\")\n          }\n\n          if (response.data.status == 200) {\n            var payments = response.data.Data.amount_wise_payment_list.map(payment => {\n              return (<tr> <th style={{ color: \"green\" }}>{payment.name?(payment.name):(\"deleted payment option\")}</th><td>{payment.amount}</td></tr>)\n            })\n            var total_amount = response.data.Data.total_amount_paid_today\n            this.setState({ payments: payments, total_amount: total_amount })\n\n          }\n          else {\n\n            this.errorOccured(response.data.status, response.error.error, \"Unknown Error Occurred\")\n          }\n        }\n        else {\n\n          this.errorOccured(500, \"error occurred\", \"Unknown error occurred\")\n\n        }\n      })\n      .catch(error => {\n        // this.errorOccured(500, \"error occurred\", error.message)\n      });\n  }\n\n  errorOccured = (status, err, message) => {\n    let error = { \"id\": this.state.errors.length + 1, \"status\": status, \"error\": err, \"message\": message }\n    let errors = this.state.errors\n    errors.push(error)\n\n    this.setState(errors)\n  }\n\n  deleteError = (e) => {\n    let key = e.currentTarget.parentNode.getAttribute(\"data-key\");\n\n    let errors = this.state.errors.filter(error => {\n      return parseInt(error.id) !== parseInt(key);\n    })\n    this.setState({ errors: errors })\n  }\n\n\n\n  update_rows = (response) => {\n\n    try {\n      let columns = this.state.datatable.columns\n      let rows = this.state.datatable.rows\n      if (response.status === 200) {\n\n        response.Data.results.forEach(element => {\n\n          if (element.customer != null) {\n            var row = { 'fname': element.customer.fname, 'lname': element.customer.lname, 'mobile': element.customer.mobile, 'amount_payable': element.amount_payable, 'total_discount': element.total_discount, 'payment_method': element.payment_method != null?element.payment_method.name:(\"deleted\"), 'date': element.customer.date, 'receipt_pdf': element.receipt_pdf ? (<a href={element.receipt_pdf} target=\"blank\">click</a>) : (\"\") }\n\n            rows.push(row)\n          }\n        }\n        )\n\n        let datatable = { columns: columns, rows: rows }\n        this.setState({ datatable: datatable })\n      }\n    }\n    catch (error) {\n      // this.errorOccured(500, \"erro occurred\", error.toString())\n\n    }\n  }\n\n  get_next = (response) => {\n    try {\n      const headers = {\n        'Authorization': 'Token ' + sessionStorage.getItem('token')\n      }\n\n      axios.get(response, { headers: headers })\n        .then(result => {\n          this.update_rows(result.data);\n          if (result.data.Data.links.next != null) {\n            this.get_next(result.data.Data.links.next)\n          }\n        })\n    }\n    catch (error) {\n      // this.errorOccured(500, \"erro occurred\", error.toString())\n\n    }\n\n  }\n\n  componentDidMount = () => {\n    const headers = {\n      'Authorization': 'Token ' + sessionStorage.getItem('token')\n    }\n    axios.get(window.API_URL+'/receipts/', {\n      headers: headers\n    })\n      .then(response => {\n        console.log(response);\n        if (response.status == 200) {\n\n          if (response.data.status == 404) {\n            this.errorOccured(404, response.data.error.error, \"Error\")\n          }\n\n          else if (response.data.status == 200) {\n            this.update_rows(response.data);\n            this.get_next(response.data.Data.links.next)\n\n          }\n          else {\n\n            this.errorOccured(response.data.status, response.error.error, \"Unknown Error Occurred\")\n          }\n        }\n        else {\n\n          this.errorOccured(500, \"erro occurred\", \"Unknown error occurred\")\n\n        }\n      })\n      .catch(error => {\n\n        // this.errorOccured(500, \"error occurred\", error.message)\n      });\n\n\n  }\n\n  render() {\n    var Error = this.state.errors.length ? this.state.errors.map(error => {\n      return (<div data-key={error.id} className='alert alert-danger alert-dismissible override'>\n        <a href=\"#\" onClick={this.deleteError} class=\"close\" data-dismiss=\"alert\" aria-label=\"close\">&times;</a>\n        <div><strong>error!</strong> {error.error}</div>\n        <div><strong>message</strong> {error.message}</div>\n        <div><strong>status</strong> {error.status}</div></div>)\n    }) : (\"\")\n    return (\n      <div>\n        <Menu />\n        {Error}\n        <div style={{ backgroundColor: \"black\", fontSize: \"15px\", color: \"green\" }}>\n          <MDBDataTableV5 className=\"table-responsive\" style={{ backgroundColor: \"black\", fontSize: \"20px\", color: \"white\" }} hover entriesOptions={[10, 20, 25]} entries={10} pagesAmount={4} data={this.state.datatable} searchTop searchBottom={false} />\n        </div>\n        <div style={{ textAlign: \"left\", backgroundColor: \"black\", fontSize: \"20px\", color: \"white\" }}>\n          <table style={{ width: \"100%\" }}>\n            <tr style={{ color: \"red\" }}>\n              <th>Payment Type</th>\n              <th>Amount Paid</th>\n            </tr>\n\n\n            {this.state.payments}\n            <tr>\n              <th style={{ color: \"blue\" }}>Total</th>\n              <td style={{ color: \"blue\" }}>{this.state.total_amount}</td>\n            </tr>\n          </table>\n        </div>\n\n      </div>\n\n    )\n\n  }\n}\nexport default Customer;"]},"metadata":{},"sourceType":"module"}